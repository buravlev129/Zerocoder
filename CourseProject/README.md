# Flower Delivery
**ITG02. Сайт для магазина доставки цветов и получения информации о заказах в Telegram**

## Запуск приложения
Создайте корневую папку приложения, например, FlowerDeliveryApplication.  
В корневую папку необходимо скопировать файлы с github.

Перейдите в корневую папку приложения, создайте в этой папке виртуальное окружение и активируйте его.
```bash
cd FlowerDeliveryApplication
d:\Python312\python.exe -m venv venv

venv\Scripts\activate
```

Инсталлируйте библиотеки Python, необходимые для работы приложения.
```bash
pip install -r requirements.txt

# Проверка версии Django
python -m django --version
```

### Запуск Web-сайта
Для запуска Django приложения необходимо создать базу данных.  
Для этого переходим в папку FlowerDelivery и запускаем миграции.
```bash
cd FlowerDelivery
python manage.py migrate
```

После создания базы данных необходимо создать учетную запись `суперпользователя`.
```bash
python manage.py createsuperuser
```
В этой команде укажите имя пользователя, е-мейл и пароль.

Запуск Django приложения:
```bash
python manage.py runserver
```

Приложение будет доступно по адресу http://127.0.0.1:8000/ 

Настройки конфигурационного файла `settings.py`
```python
# Параметры для связи с телеграм-ботом
BOT_TOKEN = "XXXXX:XXXXXXXXXX"
NOTIFICATION_CHAT_ID = '00000000000'
```

`BOT_TOKEN` - токен Telegram бота, который дается при создании бота сервисом `BotFather`.

`NOTIFICATION_CHAT_ID` - это идентификатор чата или группы в Telegram, куда Django приложение будет отправлять уведомления о поступившем новом заказе или об изменении статуса заказа.

Для получения `NOTIFICATION_CHAT_ID` нужно запустить Telegram бота (см. раздел `Запуск Telegram бота`)

В боте выполняем команду `/chatid`  
Полученный идентификатор записываем в конфигурационный файл `settings.py` и перезапускаем сервер Django.

### Запуск Telegram бота
Приложение телеграм-бота находится в папке `TelegramBot`.

Telegram бот должен быть предварительно создан с помощью сервиса `BotFather`.  
Для работы приложения нам понадобится `BOT_TOKEN`.  
Этот параметр нужно добавить в конфигурационный файл `config.py`

Настройки файла `config.py`
```python
BOT_TOKEN = "XXXXX:XXXXXXXXXX"
"""Токен телеграм-бота"""

DJANGO_API_ORDERS_URL = 'http://127.0.0.1:8000/api/orders/'
DJANGO_API_REPORTS_URL = 'http://127.0.0.1:8000/api/reports/'
```

Два последних параметра `DJANGO_API_ORDERS_URL` и `DJANGO_API_REPORTS_URL` представляют собой `end-points`,  
по которым бот посылает запросы в Django приложение.  
Если веб-адрес и порт сервера Django остается по умолчанию, то эти параметры изменять не нужно.

Запуск телеграм-бота.
```bash
python flowerdelivery_bot.py
```

## Создание пользователей
Пользователи в приложении делятся на две категории: сотрудники магазина и покупатели.  
Обе категории пользователей для работы в приложении должны зарегистрировать учетную запись и залогиниться.

Пользователь становится сотрудником магазина после того, как у него будет проставлена галка `"STAFF STATUS"` в панели администратора.

![Установка атрибутов пользователей](img/fd_adm_set_user_staff.png?raw=true "Установка атрибутов пользователей")

Панель администратора доступна по адресу http://127.0.0.1:8000/admin  
Вход с логином и паролем суперпользователя.


## Обработка нового заказа
После добавления нового заказа на сайте магазина, уведомление о новом заказе отправляется в Telegram бот.

![Уведомление о новом заказе](img/fd_bot_new_order_notification.png?raw=true "Уведомление о новом заказе")


При изменении статуса заказа, так же отправляется уведомление в Telegram бот.

![Изменение статуса заказа](img/fd_bot_change_order_status.png?raw=true "Изменение статуса заказа")


## Аналитические отчеты
Функционал Telegram бота позволяет получать информацию о заказах и аналитические отчеты.
#### Информация по категориям заказов
![Список отчетов](img/fd_bot_report_list.png?raw=true "Список отчетов")

![Информация по категориям заказов](img/fd_bot_orders_by_category.png?raw=true "Информация по категориям заказов")


#### Аналитические отчеты

![Аналитические отчеты](img/fd_bot_analytical_reports.png?raw=true "Аналитические отчеты")








